# Инструкции по запуску программы

1. Создайте виртуальное окружение (для Linux/Mac):

   ```shell
   source venv/bin/activate
   ```

2. Установите зависимости:

   ```shell
   pip install -r requirements.txt
   ```

3. Создайте файл `.env` с ключом `GOOGLE_API_KEY=...`, настройте [доступ к Google Cloud API](https://cloud.google.com/docs/authentication/api-keys-use).

4. Запустите программу:

   ```shell
   python main.py
   ```

5. Запустите тесты:

   ```shell
   python test.py
   ```

6. Выйдите из виртуального окружения:

   ```shell
   deactivate
   ```

# Подход к решению задачи

Решил взять модель `gemini-2.0-flash` из-за баланса цены и качества на основе данных [Chatbot Arena](https://lmarena.ai/). Сначала пробовал `gpt-4o-mini`, но часто получал неточные результаты. Можно также взять `gpt-4o`, но она значительно дороже.

Для решения задачи использовал следующий подход:

1. **Загрузка данных в SQL**: CSV имеет табличную структуру, что позволяет его легко преобразовать в SQL базу данных. Это позволяет воспользоваться инструментами SQL.

2. **Использование LLM для генерации SQL запросов**: LLM хорошо справляются с генерацией SQL запросов. Однако тут стоит быть осторожными с правами доступа, чтобы данные не пострадали. Для удобства работы был выбран фреймворк [langchain](https://python.langchain.com/).

3. **Интерпретация результатов выполнения SQL запроса**: анализ результатов тоже выполняется с помощью модели `gemini-2.0-flash`.

4. **CLI интерфейс**: после запуска программы пользователь может вводить запросы в цикле, выход возможен с помощью Ctrl+C или при вводе "exit" в качестве запроса.

# Оценка эффективности и точности работы системы

Для простоты данное решение не имеет доступа к истории сообщений (памяти), хотя это можно добавить при необходимости.

Для оценки решения было решено применить библиотеку [OpenEvals](https://github.com/langchain-ai/openevals). Она легко интегрируется с моим решением и предоставляет удобный способ для оценки по нескольким метрикам. Также был составлен вручную набор тестов, который включает примеры запросов и ожидаемые ответы.

## Результаты оценки точности

Я взял две метрики для оценки точности:

1. Correctness - measure "how similar/correct is the generated answer relative to a ground-truth answer"

2. Helpfulnes - measure "how well does the generated response address the initial user input"

В результате из 5 тестов все успешно отработали. Однако результат недетерминирован. Бывает, что не все тесты помечаются, как пройденные.

```shell
python test.py
Test case 1 of 5: {'correctness': True, 'helpfulness': True}
Test case 2 of 5: {'correctness': True, 'helpfulness': True}
Test case 3 of 5: {'correctness': True, 'helpfulness': True}
Test case 4 of 5: {'correctness': True, 'helpfulness': True}
Test case 5 of 5: {'correctness': True, 'helpfulness': True}
Average Scores: {'correctness': 1.0, 'helpfulness': 1.0}
```

# Критерии оценки качества решения

## Простота реализации

Итоговое решение получилось очень кратким.
Файл `main.py` содержит всего 69 строк кода.

## Стоимость

Для расчета стоимости одного запроса нужно учитывать:

Стоимость за 1М входных токенов: $0.10
Стоимость за 1М выходных токенов: $0.40

Для точного подсчета надо смотреть метрики или использовать методы библиотеки. Но у меня не получилось найти для моделей Google такой функционал в langchain. А в админке Google у меня free tier, не выходит посмотреть. Дам примерную оценку.

Входные токены: ~170
Выходные токены: ~130

Примерная стоимость одного запроса составляет **$0.000069**.

## Скорость

Время выполнения запроса примерно 7 сек.

```shell
time python main.py
Приблизительно 33.85% фрилансеров, считающих себя экспертами, выполнили менее 100 проектов.

real    0m6.967s
user    0m2.979s
sys     0m0.269s
```
